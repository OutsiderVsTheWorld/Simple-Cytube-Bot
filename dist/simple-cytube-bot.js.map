{"version":3,"sources":["util/message-filter.js","util/stringifyStyles.js","Command.js","commands/dice.js","commands/webm.js","commands/who.js","simple-cytube-bot.js"],"names":["msg","replace","trim","styles","style","styleString","Object","entries","reduce","propName","propValue","Command","config","assign","text","handler","params","data","condition","Number","isInteger","randomInteger","min","max","rand","Math","random","floor","normalizeParams","map","param","number","parseInt","isNaN","bot","sendMessage","num","username","CommandWebm","FETCH_PROXY","FILE_TYPE_WEBM","FILE_TYPE_MP4","FILE_TYPES","addMedia","user","video","window","CLIENT","name","socket","emit","id","path","title","fullname","pos","type","temp","getRandomWebm","thread","fetchVideosFromThread","then","videos","length","fetch","res","json","threads","posts","post","files","file","includes","push","slice","search","delay","count","timer","setTimeout","cb","clearTimeout","webm","catch","PREFIX","POSTFIX","userlistElems","document","getElementById","children","users","i","textContent","formatedMessage","Bot","cmdFilterPrefix","commands","messageStyles","message","display","color","botSendMessage","registerListeners","registerDefaultCommnds","applyBotMessageStyles","console","log","on","LASTCHAT","commandDispatch","commandRegister","CommandDice","CommandWho","elementStyle","createElement","nameStyles","innerHTML","head","appendChild","split","cmdText","shift","find","cmd","recieve","SimpleCytubeBot"],"mappings":"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","file":"simple-cytube-bot.js","sourceRoot":"..\\src","sourcesContent":["export default (msg) => {\r\n  return msg\r\n    .replace(/&#39;/g,  `'`)\r\n    .replace(/&amp;/g,  '&')\r\n    .replace(/&lt;/g,   '<')\r\n    .replace(/&gt;/g,   '>')\r\n    .replace(/&quot;/g, '\"')\r\n    .replace(/&#40;/g,  '(')\r\n    .replace(/&#41;/g,  ')')\r\n    .replace(/(<([^>]+)>)/ig, '')\r\n    .replace(/^[ \\t]+/g, '')\r\n    .trim()\r\n}","export default styles => {\r\n  let style = { ...styles };\r\n  \r\n  let styleString = (\r\n    Object.entries(style).reduce((styleString, [propName, propValue]) => {\r\n      return `${styleString}${propName}:${propValue};`;\r\n    }, '')\r\n  );\r\n\r\n  return styleString\r\n}","class Command {\r\n  constructor(config) {\r\n    Object.assign(this, {\r\n      text: \"\",\r\n      handler: () => {}\r\n    }, config)\r\n  }\r\n\r\n  recieve(params, data) {\r\n    this.handler(params, data)\r\n  }\r\n}\r\n\r\nexport default Command;","function condition(params) {\r\n  return (\r\n    (!params) ||\r\n    (!Number.isInteger(params[0])) ||\r\n    (!Number.isInteger(params[1])) ||\r\n    (params[0] > params[1])\r\n  )\r\n}\r\n\r\nfunction randomInteger(min, max) {\r\n  let rand = min + Math.random() * (max + 1 - min);\r\n  return Math.floor(rand);\r\n}\r\n\r\nexport default {\r\n  text: \"dice\",\r\n  handler: (params, data) => {\r\n    let normalizeParams = params.map(param => {\r\n      let number = parseInt(param);\r\n      return isNaN(number) ? param : number;\r\n    });\r\n\r\n    if (condition(normalizeParams)) {\r\n      return data.bot.sendMessage(\"Использование: !dice <min> <max>\")\r\n    }\r\n\r\n    let min = normalizeParams[0]\r\n    let max = normalizeParams[1]\r\n    let num = randomInteger(min, max)\r\n\r\n    data.bot.sendMessage(`${data.username} бросает кости... Выпало ${num}`)\r\n  }\r\n}","const FETCH_PROXY = \"https://yacdn.org/serve/\"\r\n\r\nconst FILE_TYPE_WEBM = 6\r\nconst FILE_TYPE_MP4 = 10\r\n\r\nconst FILE_TYPES = [FILE_TYPE_WEBM, FILE_TYPE_MP4]\r\n\r\nfunction addMedia(params) {\r\n  const {user, video} = params\r\n\r\n  if (window.CLIENT.name === user) {\r\n    window.socket.emit(\"queue\", {\r\n      id: `https://2ch.hk${video.path}`,\r\n      title: video.fullname,\r\n      pos: \"end\",\r\n      type: \"fi\",\r\n      temp: true\r\n    })\r\n  }\r\n}\r\n\r\nfunction getRandomWebm(thread) {\r\n  return fetchVideosFromThread(thread).then(videos => {\r\n    return videos[randomInteger(0, videos.length - 1)]\r\n  })\r\n}\r\n\r\nfunction fetchVideosFromThread(thread) {\r\n  let videos = []\r\n  return fetch(`${FETCH_PROXY}${thread}`)\r\n    .then(res => res.json())\r\n    .then(data => {\r\n      for (let post of data.threads[0].posts) {\r\n        for (let file of post.files) {\r\n          if (FILE_TYPES.includes(file.type)) {\r\n            videos.push(file)\r\n          }\r\n        }\r\n      }\r\n\r\n      return videos\r\n    })\r\n}\r\n\r\nfunction randomInteger(min, max) {\r\n  let rand = min + Math.random() * (max + 1 - min);\r\n  return Math.floor(rand);\r\n}\r\n\r\nconst CommandWebm = {\r\n  text: \"webm\",\r\n  handler: (params, data) => {\r\n    if (!params[0]) {\r\n      return data.bot.sendMessage(\"Использование: !webm <thread> [all].\")\r\n    }\r\n\r\n    let thread = params[0].slice(0, params[0].search(\".html\"))\r\n    thread += \".json\"\r\n\r\n    if (params[1] === \"all\") {\r\n      fetchVideosFromThread(thread).then(videos => {\r\n        let delay = 1000.\r\n        let extraDelay = 3000.\r\n        let count = 0\r\n\r\n        let timer = setTimeout(function cb() {\r\n          addMedia({\r\n            user: data.username,\r\n            video: videos[count]\r\n          })\r\n\r\n          count++\r\n\r\n          if (count % 10 == 0) delay = extraDelay\r\n          else delay = 1000.\r\n\r\n          clearTimeout(timer)\r\n\r\n          if (count < videos.length) timer = setTimeout(cb, delay)\r\n        }, delay)\r\n      })\r\n    } else {\r\n      getRandomWebm(thread).then(webm => {\r\n        addMedia({\r\n          user: data.username,\r\n          video: webm\r\n        })\r\n      }).catch(() => {\r\n        data.bot.sendMessage(\"Ссылка всратая. Исправляй.\")\r\n      })\r\n    }\r\n  }\r\n}\r\n\r\nexport default CommandWebm","function randomInteger(min, max) {\r\n  let rand = min + Math.random() * (max + 1 - min);\r\n  return Math.floor(rand);\r\n}\r\n\r\nconst PREFIX = [\r\n  \"Так... Ну, \",\r\n  \"Этот ебучий  \"\r\n]\r\n\r\nconst POSTFIX = [\r\n  \", базарю!\",\r\n  \", дебильчики.\",\r\n  \", ослики.\"\r\n]\r\n\r\nexport default {\r\n  text: \"who\",\r\n  handler: (params, data) => {\r\n    if (!params[0]) {\r\n      return data.bot.sendMessage(\"Использование: !who <something>.\")\r\n    }\r\n\r\n    const userlistElems = document.getElementById(\"userlist\").children;\r\n    const users = []\r\n    for (let i = 0; i < userlistElems.length; i++) {\r\n      users.push(userlistElems[i].children[1].textContent);\r\n    }\r\n\r\n    let formatedMessage = PREFIX[randomInteger(0, PREFIX.length-1)] +\r\n      `${users[randomInteger(0, users.length-1)]} — ${params[0]}` +\r\n      POSTFIX[randomInteger(0, POSTFIX.length-1)]\r\n\r\n    data.bot.sendMessage(formatedMessage)\r\n  }\r\n}","import filterMessage from \"./util/message-filter\"\r\nimport stringifyStyles from \"./util/stringifyStyles\"\r\n\r\nimport Command from \"./Command\"\r\n\r\nimport CommandDice from \"./commands/dice\"\r\nimport CommandWebm from \"./commands/webm\"\r\nimport CommandWho from \"./commands/who\"\r\n\r\nclass Bot {\r\n  constructor(config) {\r\n    Object.assign(this, {\r\n      name: \"Bot\",\r\n      cmdFilterPrefix: \"!\",\r\n      commands: [],\r\n      messageStyles: {\r\n        message: {\r\n          display: \"inline\"\r\n        },\r\n        name: {\r\n          color: \"pink\"\r\n        }\r\n      }\r\n    }, config)\r\n\r\n    this.botSendMessage = false\r\n\r\n    this.registerListeners(config.socket)\r\n    this.registerDefaultCommnds()\r\n    this.applyBotMessageStyles()\r\n\r\n    console.log(\"Simple Cytube Bot successfuly initialzed!\")\r\n  }\r\n\r\n  registerListeners(socket) {\r\n    socket.on(\"chatMsg\", data => {\r\n      if (this.botSendMessage) {\r\n        window.LASTCHAT.name = \"\"\r\n        this.botSendMessage = false\r\n      }\r\n\r\n      if (data.msg[0] === this.cmdFilterPrefix) {\r\n        this.commandDispatch(data)\r\n      }\r\n    })\r\n  }\r\n\r\n  registerDefaultCommnds() {\r\n    this.commandRegister(CommandDice)\r\n    this.commandRegister(CommandWebm)\r\n    this.commandRegister(CommandWho)\r\n  }\r\n\r\n  applyBotMessageStyles() {\r\n    let elementStyle = document.createElement(\"style\");\r\n    let messageStyles = stringifyStyles(this.messageStyles.message)\r\n    let nameStyles = stringifyStyles(this.messageStyles.name)\r\n\r\n    elementStyle.innerHTML = \"/* Simple Cytube Bot Styles */ \"\r\n    elementStyle.innerHTML += `.chat-msg-bot { ${messageStyles} }`\r\n    elementStyle.innerHTML += `.bot-name { ${nameStyles} }`\r\n\r\n    document.head.appendChild(elementStyle)\r\n  }\r\n\r\n  commandRegister(config) {\r\n    this.commands.push(new Command(config))\r\n  }\r\n\r\n  commandDispatch(data) {\r\n    let split = filterMessage(data.msg).split(\" \")\r\n    let cmdText = split.shift().slice(1)\r\n    let params = split\r\n\r\n    this.commands.find(cmd => {\r\n      if (cmd.text === cmdText) {\r\n        data.bot = this;\r\n\r\n        cmd.recieve(params, data)\r\n      }\r\n    })\r\n  }\r\n\r\n  sendMessage(message) {\r\n    if (window.CLIENT.name === window.LASTCHAT.name) {\r\n      let formatedMessage = `[botmsg][botname]${this.name}: [/botname]${message}[/botmsg]`\r\n      this.socket.emit(\"chatMsg\", { msg: formatedMessage })\r\n    }\r\n\r\n    this.botSendMessage = true\r\n  }\r\n}\r\n\r\nwindow.SimpleCytubeBot = Bot;"]}